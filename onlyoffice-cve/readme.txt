CVE-?

[Suggested description]
Directory traversal vulnerability was discovered in ONLYOFFICE DocumentServer 5.6.2.
Enabling JWT token on the server allows an attacker to overwrite an arbitrary file 
with controlled data under minor restrictions with the privileges of the user from 
which the server is started.

------------------------------------------

[Vulnerability Type]
Directory Traversal

------------------------------------------

[Vendor of the product]
ONLYOFFICE - https://www.onlyoffice.com/

------------------------------------------

[Affected products]
DocumentServer - https://github.com/ONLYOFFICE/DocumentServer
Affected versions: 5.1.5 - 5.6.2
Fixed version: 5.6.3

server - https://github.com/ONLYOFFICE/server/tree/4b2c6e50d6c673b989c71ece893fbd3a5782fe7e
Affected versions: 5.1.5.4 - 5.6.3.1
Fixed version: 5.6.3.2

------------------------------------------

[Affected components]
Affected module: https://github.com/ONLYOFFICE/server/tree/v5.6.3.1 
Affected function: https://github.com/ONLYOFFICE/server/blob/v5.6.3.1/DocService/sources/fileuploaderservice.js#L195

------------------------------------------

[Attack type]
Remote

------------------------------------------

[Impact]
Code execution
Denial of Service

------------------------------------------

[Attack vector]
To exploit the vulnerability, an attacker must use a specially crafted request to 
the server, which will overwrite an arbitrary file with controlled data. If one of 
the executable files of the service was overwritten by this attack, then there are 
the following effects:
- the next attacker request to the server causes execution of new file from the 
previous step, that will lead to remote code execution
- the lack of a correct executable file of service leads to denial of service

File overwriting occurs in "uploadImageFile" function as a result of saving file to 
the path specified in "strPath" variable, which is concatenation the values of 
several other strings, the last of which ("formatStr") is controlled by the attacker 
when certain conditions are met:
- "isValidJwt" is true
- "docId" and "encrypted" are presented in JWT token
- there is a buffer in request body to which the file will be overwritten
- buffer must starts with text "ENCRYPTED;", then string with relative path from 
server media directory ("/var/lib/onlyoffice/documentserver/App_Data/cache/files/
<docId>/media/<random_hash><controlled_filename>" by default) to overwriting file 
and then ";".

------------------------------------------

[References]
https://github.com/ONLYOFFICE/DocumentServer/blob/master/CHANGELOG.md#563

